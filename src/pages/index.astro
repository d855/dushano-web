---
import ArticleCard from "../components/ArticleCard.astro";
import Layout from "../layouts/Layout.astro";

// Fetch all markdown files from the blog directory
const postImports = import.meta.glob("../blog/*.md");
const posts = await Promise.all(
    Object.entries(postImports).map(async ([path, resolver]) => {
        const post = await resolver();
        return {
            ...post,
            file: path
        };
    })
);

// Sort posts by date in descending order (newest first)
const sortedPosts = posts.sort(
    (a, b) =>
        new Date(b.frontmatter.publishDate).valueOf() -
        new Date(a.frontmatter.publishDate).valueOf(),
);
---

<Layout title="Home">
    <h1 class="text-4xl">Software engineer and amatuer writer</h1>
    <p class="mt-2 font-light font-sm">
        Maker of things that work. <br /> I solve tricky problems with clean, practical
        solutions that grow with your needs.
    </p>

    <section class="mt-10">
        <h2 class="text-2xl font-semibold">Latest</h2>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-1">
            {
                sortedPosts.map((post) => (
                    <ArticleCard
                        title={post.frontmatter.title}
                        description={post.frontmatter.description}
                        image={post.frontmatter.image.url}
                        imageAlt={post.frontmatter.image.alt}
                        url={`/blog/${post.file.split("/").pop().replace(".md", "")}`}
                    />
                ))
            }
        </div>
    </section>
</Layout>
