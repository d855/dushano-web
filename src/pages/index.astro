---
import ArticleCard from "../components/ArticleCard.astro";
import Metadata from "../components/Metadata.astro";
import Layout from "../layouts/Layout.astro";

// Fetch all markdown files from the blog directory
const postImports = import.meta.glob("../blog/*.md");
const posts = await Promise.all(
    Object.entries(postImports).map(async ([path, resolver]) => {
        const post = await resolver();
        return {
            ...post,
            file: path,
            // Get the raw content from the post
            content: post.rawContent ? post.rawContent() : post.compiledContent ? post.compiledContent() : '',
        };
    }),
);

// Sort posts by date in descending order (newest first)
const sortedPosts = posts.sort(
    (a, b) =>
        new Date(b.frontmatter.publishDate).valueOf() -
        new Date(a.frontmatter.publishDate).valueOf(),
);
---

<Layout title="Dušan Osmokrović">
    <Metadata
        title="Home"
        canonicalUrl="google.rs"
        type="website"
        slot="head"
    />
    <h1 class="text-4xl">Software Engineer & Amateur Writer</h1>
    <p class="mt-2 font-sm">
        Maker of things that work. <br /> I solve tricky problems with clean, practical
        solutions that grow with your needs.
    </p>

    <section class="my-10">
        <h2 class="uppercase">Latest</h2>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-1">
            {
                sortedPosts.map((post) => (
						<ArticleCard
								title={post.frontmatter.title}
								description={post.frontmatter.description}
								image={post.frontmatter.image.url}
								imageAlt={post.frontmatter.image.alt}
								publishDate={post.frontmatter.publishDate}
								content={post.content}
								url={`/blog/${post.file.split("/").pop().replace(".md", "")}`}
						/>
                ))
            }
        </div>
    </section>
</Layout>
